<!--
@name: å¼€å‘è€…å‚è€ƒ
@description: å±•ç¤ºæ‰€æœ‰å¯ç”¨æ•°æ®å­—æ®µçš„å¼€å‘è€…å‚è€ƒæ¨¡æ¿
@author: LunaBox
@version: 1.0.0
-->
<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LunaBox æ¨¡æ¿å¼€å‘æŒ‡å—</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Monaco', 'Consolas', monospace;
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 32px;
            font-size: 13px;
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        h1 {
            color: #569cd6;
            font-size: 24px;
            margin-bottom: 24px;
        }

        h2 {
            color: #4ec9b0;
            font-size: 16px;
            margin: 24px 0 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #333;
        }

        .section {
            background: #252526;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .field {
            margin: 8px 0;
        }

        .field-name {
            color: #9cdcfe;
        }

        .field-type {
            color: #4ec9b0;
            font-size: 11px;
            margin-left: 8px;
        }

        .field-value {
            color: #ce9178;
            margin-left: 16px;
        }

        .code {
            background: #1e1e1e;
            padding: 2px 6px;
            border-radius: 4px;
            color: #dcdcaa;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 8px;
        }

        th,
        td {
            text-align: left;
            padding: 8px;
            border-bottom: 1px solid #333;
        }

        th {
            color: #569cd6;
        }

        .chart-box {
            height: 200px;
            margin-top: 12px;
            background: #1e1e1e;
            border-radius: 8px;
            padding: 12px;
        }

        .tip {
            background: #2d2d30;
            padding: 12px;
            border-left: 3px solid #569cd6;
            margin: 12px 0;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ“š LunaBox æ¨¡æ¿å¼€å‘æŒ‡å—</h1>

        <div class="tip">
            <strong>æç¤ºï¼š</strong>æœ¬æ¨¡æ¿å±•ç¤ºäº†æ‰€æœ‰å¯ç”¨çš„æ•°æ®å­—æ®µå’Œç¤ºä¾‹å€¼ã€‚ä½ å¯ä»¥å‚è€ƒè¿™ä¸ªæ¨¡æ¿æ¥åˆ›å»ºè‡ªå·±çš„è‡ªå®šä¹‰æ¨¡æ¿ã€‚
            æ¨¡æ¿ä½¿ç”¨ Go çš„ <span class="code">html/template</span> è¯­æ³•ã€‚
        </div>

        <!-- ==================== å…ƒæ•°æ® ==================== -->
        <h2>ğŸ“‹ å…ƒæ•°æ® (Metadata)</h2>
        <div class="section">
            <div class="field">
                <span class="field-name">.ExportTime</span>
                <span class="field-type">string</span>
                <div class="field-value">"{{.ExportTime}}"</div>
            </div>
            <div class="field">
                <span class="field-name">.StartDate</span>
                <span class="field-type">string</span>
                <div class="field-value">"{{.StartDate}}"</div>
            </div>
            <div class="field">
                <span class="field-name">.EndDate</span>
                <span class="field-type">string</span>
                <div class="field-value">"{{.EndDate}}"</div>
            </div>
            <div class="field">
                <span class="field-name">.Period</span>
                <span class="field-type">string</span>
                <div class="field-value">"{{.Period}}" (week/month/day)</div>
            </div>
        </div>

        <!-- ==================== æ¦‚è§ˆæ•°æ® ==================== -->
        <h2>ğŸ“Š æ¦‚è§ˆæ•°æ® (Overview)</h2>
        <div class="section">
            <div class="field">
                <span class="field-name">.TotalPlayCount</span>
                <span class="field-type">int</span>
                <div class="field-value">{{.TotalPlayCount}}</div>
            </div>
            <div class="field">
                <span class="field-name">.TotalPlayDuration</span>
                <span class="field-type">int (ç§’)</span>
                <div class="field-value">{{.TotalPlayDuration}}</div>
            </div>
            <div class="field">
                <span class="field-name">.TotalPlayTimeStr</span>
                <span class="field-type">string (æ ¼å¼åŒ–)</span>
                <div class="field-value">"{{.TotalPlayTimeStr}}"</div>
            </div>
        </div>

        <!-- ==================== æ’è¡Œæ¦œæ•°æ® ==================== -->
        <h2>ğŸ† æ’è¡Œæ¦œæ•°æ® (Leaderboard)</h2>
        <div class="section">
            <p>ä½¿ç”¨ <span class="code">{{"{{"}}range .Leaderboard{{"}}"}}</span> éå†</p>
            <table>
                <tr>
                    <th>å­—æ®µ</th>
                    <th>ç±»å‹</th>
                    <th>è¯´æ˜</th>
                </tr>
                <tr>
                    <td>.Rank</td>
                    <td>int</td>
                    <td>æ’å (1-based)</td>
                </tr>
                <tr>
                    <td>.GameID</td>
                    <td>string</td>
                    <td>æ¸¸æˆID</td>
                </tr>
                <tr>
                    <td>.GameName</td>
                    <td>string</td>
                    <td>æ¸¸æˆåç§°</td>
                </tr>
                <tr>
                    <td>.CoverURL</td>
                    <td>string</td>
                    <td>å°é¢åŸå§‹URL</td>
                </tr>
                <tr>
                    <td>.CoverBase64</td>
                    <td>string</td>
                    <td>å°é¢Base64 (æ¨èä½¿ç”¨)</td>
                </tr>
                <tr>
                    <td>.TotalDuration</td>
                    <td>int</td>
                    <td>æ—¶é•¿(ç§’)</td>
                </tr>
                <tr>
                    <td>.DurationStr</td>
                    <td>string</td>
                    <td>æ ¼å¼åŒ–æ—¶é•¿</td>
                </tr>
            </table>

            <h3 style="margin-top: 16px; color: #dcdcaa;">å½“å‰æ•°æ®ï¼š</h3>
            {{range $index, $game := .Leaderboard}}
            <div style="padding: 8px; margin: 4px 0; background: #1e1e1e; border-radius: 4px;">
                #{{$game.Rank}} {{$game.GameName}} - {{$game.DurationStr}}
            </div>
            {{else}}
            <div style="color: #666;">æš‚æ— æ’è¡Œæ¦œæ•°æ®</div>
            {{end}}
        </div>

        <!-- ==================== å›¾è¡¨æ•°æ® ==================== -->
        <h2>ğŸ“ˆ å›¾è¡¨æ•°æ® (Chart Data)</h2>
        <div class="section">
            <div class="field">
                <span class="field-name">.ChartLabels</span>
                <span class="field-type">string (JSONæ•°ç»„)</span>
                <div class="field-value" style="word-break: break-all;">{{.ChartLabels}}</div>
            </div>
            <div class="field">
                <span class="field-name">.ChartData</span>
                <span class="field-type">string (JSONæ•°ç»„, å°æ—¶)</span>
                <div class="field-value" style="word-break: break-all;">{{.ChartData}}</div>
            </div>
            <div class="field">
                <span class="field-name">.GameTrendData</span>
                <span class="field-type">string (JSON, Chart.js datasets)</span>
                <div class="field-value" style="word-break: break-all; max-height: 100px; overflow: auto;">
                    {{.GameTrendData}}</div>
            </div>

            <h3 style="margin-top: 16px; color: #dcdcaa;">Chart.js ç¤ºä¾‹ï¼š</h3>
            <div class="chart-box">
                <canvas id="demoChart"></canvas>
            </div>
        </div>

        <!-- ==================== æ—¶é—´çº¿æ•°æ® ==================== -->
        <h2>â±ï¸ æ—¶é—´çº¿æ•°æ® (Timeline)</h2>
        <div class="section">
            <p>ä½¿ç”¨ <span class="code">{{"{{"}}range .Timeline{{"}}"}}</span> éå†</p>
            <table>
                <tr>
                    <th>å­—æ®µ</th>
                    <th>ç±»å‹</th>
                    <th>è¯´æ˜</th>
                </tr>
                <tr>
                    <td>.Label</td>
                    <td>string</td>
                    <td>æ—¥æœŸæ ‡ç­¾</td>
                </tr>
                <tr>
                    <td>.Duration</td>
                    <td>int</td>
                    <td>æ—¶é•¿(ç§’)</td>
                </tr>
                <tr>
                    <td>.DurationStr</td>
                    <td>string</td>
                    <td>æ ¼å¼åŒ–æ—¶é•¿</td>
                </tr>
                <tr>
                    <td>.Hours</td>
                    <td>float64</td>
                    <td>å°æ—¶æ•°</td>
                </tr>
            </table>
        </div>

        <!-- ==================== AIæ€»ç»“ ==================== -->
        <h2>ğŸ¤– AIæ€»ç»“ (AI Summary)</h2>
        <div class="section">
            <div class="field">
                <span class="field-name">.AISummary</span>
                <span class="field-type">string</span>
                <div class="field-value">"{{if .AISummary}}{{.AISummary}}{{else}}(æ— AIæ€»ç»“){{end}}"</div>
            </div>
        </div>

        <!-- ==================== åº”ç”¨ä¿¡æ¯ ==================== -->
        <h2>â„¹ï¸ åº”ç”¨ä¿¡æ¯ (App Info)</h2>
        <div class="section">
            <div class="field">
                <span class="field-name">.AppName</span>
                <span class="field-type">string</span>
                <div class="field-value">"{{.AppName}}"</div>
            </div>
            <div class="field">
                <span class="field-name">.AppVersion</span>
                <span class="field-type">string</span>
                <div class="field-value">"{{.AppVersion}}"</div>
            </div>
        </div>

        <!-- ==================== æ¨¡æ¿å‡½æ•° ==================== -->
        <h2>ğŸ”§ å¯ç”¨æ¨¡æ¿å‡½æ•°</h2>
        <div class="section">
            <table>
                <tr>
                    <th>å‡½æ•°</th>
                    <th>ç¤ºä¾‹</th>
                    <th>è¯´æ˜</th>
                </tr>
                <tr>
                    <td>add</td>
                    <td><span class="code">{{"{{"}}add 1 2{{"}}"}}</span></td>
                    <td>åŠ æ³•: 3</td>
                </tr>
                <tr>
                    <td>sub</td>
                    <td><span class="code">{{"{{"}}sub 5 2{{"}}"}}</span></td>
                    <td>å‡æ³•: 3</td>
                </tr>
                <tr>
                    <td>mul</td>
                    <td><span class="code">{{"{{"}}mul 2 3{{"}}"}}</span></td>
                    <td>ä¹˜æ³•: 6</td>
                </tr>
                <tr>
                    <td>div</td>
                    <td><span class="code">{{"{{"}}div 6 2{{"}}"}}</span></td>
                    <td>é™¤æ³•: 3</td>
                </tr>
                <tr>
                    <td>formatDuration</td>
                    <td><span class="code">{{"{{"}}formatDuration 3661{{"}}"}}</span></td>
                    <td>æ ¼å¼åŒ–ç§’æ•°</td>
                </tr>
                <tr>
                    <td>json</td>
                    <td><span class="code">{{"{{"}}json .Leaderboard{{"}}"}}</span></td>
                    <td>è½¬JSONå­—ç¬¦ä¸²</td>
                </tr>
                <tr>
                    <td>safeJS</td>
                    <td><span class="code">{{"{{"}} .ChartLabels | safeJS {{"}}"}}</span></td>
                    <td>å®‰å…¨è¾“å‡ºJS (ä¸è½¬ä¹‰)</td>
                </tr>
                <tr>
                    <td>safeHTML</td>
                    <td><span class="code">{{"{{"}} .AISummary | safeHTML {{"}}"}}</span></td>
                    <td>å®‰å…¨è¾“å‡ºHTML (ä¸è½¬ä¹‰)</td>
                </tr>
            </table>
        </div>

    </div>

    <div id="debug-data-config" style="display:none;" data-labels="{{.ChartLabels | safeJS}}"
        data-values="{{.ChartData | safeJS}}">
    </div>
    <script>
        const configEl = document.getElementById('debug-data-config');
        if (configEl) {
            try {
                // è¯»å– HTML å±æ€§ä¸­çš„ JSON å­—ç¬¦ä¸²
                // æ³¨æ„ï¼šåœ¨å®é™…æ¸²æŸ“æ—¶ï¼ŒGoæ¨¡æ¿ä¼šå°†åŒå¼•å·è½¬ä¹‰ï¼Œæ‰€ä»¥è¿™é‡Œå¯èƒ½éœ€è¦ç‰¹æ®Šå¤„ç†
                // æˆ–è€…æ›´å®‰å…¨çš„æ–¹å¼æ˜¯ä¾ç„¶ä½¿ç”¨ script type="application/json"
                // ä¸ºäº†æ¼”ç¤ºä¸€è‡´æ€§ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨ script æ ‡ç­¾
            } catch (e) { }
        }
    </script>

    <script id="chart-demo-config" type="application/json">
        {
            "labels": {{ .ChartLabels | safeJS }},
            "data": {{ .ChartData | safeJS }}
        }
    </script>

    <script>
        // ä» hidden script ä¸­è¯»å–é…ç½®ï¼Œé¿å…ç¼–è¾‘å™¨æŠŠ Go æ¨¡æ¿è¯­æ³•è¯¯åˆ¤ä¸ºéæ³• JS
        let config = {};
        try {
            const el = document.getElementById('chart-demo-config');
            if (el) config = JSON.parse(el.textContent);
        } catch (e) {
            console.error(e);
        }

        if (config.labels) {
            const ctx = document.getElementById('demoChart');
            if (ctx) {
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: config.labels,
                        datasets: [{
                            label: 'æ¸¸ç©æ—¶é•¿ (å°æ—¶)',
                            data: config.data,
                            borderColor: '#569cd6',
                            backgroundColor: 'rgba(86, 156, 214, 0.1)',
                            tension: 0.3,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { labels: { color: '#d4d4d4' } } },
                        scales: {
                            x: { grid: { color: '#333' }, ticks: { color: '#888' } },
                            y: { grid: { color: '#333' }, ticks: { color: '#888' } }
                        }
                    }
                });
            }
        }
    </script>
</body>

</html>